<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title will be set by JavaScript -->
    <title>Loading... | SIMS Media Hive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Supabase JS Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Marked.js Library for Markdown Rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* Your existing styles */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Oswald:wght@200..700&display=swap');
        :root { --primary-color: #eab308; --dark-bg: #0d0d0d; --mid-bg: #1a1a1a; --text-light: #f3f4f6; --text-muted: #9ca3af; }
        body { font-family: 'Inter', sans-serif; background-color: var(--dark-bg); color: var(--text-light); overflow-x: hidden; padding-top: 6rem; }
        .oswald { font-family: 'Oswald', sans-serif; }
        .post-content h1, .post-content h2, .post-content h3, .post-content h4, .post-content h5, .post-content h6 { font-family: 'Oswald', sans-serif; color: var(--text-light); margin-top: 1.5em; margin-bottom: 0.8em; padding-bottom: 0.3em; border-bottom: 1px solid #374151; }
        .post-content h1 { font-size: 2.5rem; } .post-content h2 { font-size: 2rem; color: var(--primary-color); } .post-content h3 { font-size: 1.75rem; } .post-content h4 { font-size: 1.5rem; }
        .post-content p { margin-bottom: 1.5rem; line-height: 1.75; color: #d1d5db; font-size: 1.125rem; }
        .post-content ul, .post-content ol { margin-left: 1.5rem; margin-bottom: 1.5rem; padding-left: 0.5rem; color: #d1d5db; }
         .post-content ul { list-style: disc; } .post-content ol { list-style: decimal; }
        .post-content li { margin-bottom: 0.75rem; line-height: 1.6; }
         .post-content li > p { margin-bottom: 0.5rem; }
        .post-content strong { color: #fff; font-weight: 600; }
        .post-content a { color: #facc15; text-decoration: underline; hover:text-yellow-300; }
        .post-content blockquote { border-left: 4px solid var(--primary-color); padding-left: 1rem; margin-left: 0; margin-bottom: 1.5rem; font-style: italic; color: #9ca3af; }
        .post-content blockquote p { margin-bottom: 0.5rem; }
        /* Styles for media embedded via Markdown/HTML */
        .post-content img, .post-content video { max-width: 100%; height: auto; border-radius: 0.5rem; margin-top: 2rem; margin-bottom: 2rem; display: block; margin-left: auto; margin-right: auto; border: 1px solid #374151; }
    </style>
</head>
<body class="antialiased">

    <!-- Header -->
    <header class="bg-black fixed top-0 left-0 w-full z-10 pt-6 shadow-xl border-b border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-start">
            <div class="text-xl font-extrabold tracking-widest text-white oswald"><a href="/index.html">SIMS Media Hive</a></div>
            <div class="hidden md:block text-right text-xs text-gray-400"><p>gds.simshive@gmail.com</p><p>+91 9876 543 210</p></div>
            <button id="mobile-menu-button" class="md:hidden p-2 text-yellow-500 hover:text-white transition duration-300 z-30"><i data-lucide="menu" class="w-7 h-7"></i></button>
        </div>
        <nav class="hidden md:flex justify-center mt-4 pb-4"><ul class="flex space-x-8 text-sm font-medium uppercase tracking-widest text-gray-300"><li><a href="/index.html" class="hover:text-yellow-500 transition duration-300">Home</a></li><li><a href="/index.html#focus" class="hover:text-yellow-500 transition duration-300">Focus</a></li><li><a href="/index.html#work" class="hover:text-yellow-500 transition duration-300">Projects</a></li><li><a href="/members.html" class="hover:text-yellow-500 transition duration-300">Members</a></li><li><a href="/blog.html" class="text-yellow-500 transition duration-300">Blog</a></li><li><a href="/contact.html" class="hover:text-yellow-500 transition duration-300">Join Us</a></li></ul></nav>
        <nav id="mobile-menu" class="hidden md:hidden fixed top-0 left-0 w-full h-full bg-gray-950/95 backdrop-blur-sm pt-24 pb-8 overflow-y-auto z-10"><ul class="flex flex-col items-center space-y-8 text-xl font-semibold uppercase tracking-widest text-gray-300"><li><a href="/index.html" class="hover:text-yellow-500 transition duration-300 block py-2">Home</a></li><li><a href="/index.html#focus" class="hover:text-yellow-500 transition duration-300 block py-2">Focus</a></li><li><a href="/index.html#work" class="hover:text-yellow-500 transition duration-300 block py-2">Projects</a></li><li><a href="/members.html" class="hover:text-yellow-500 transition duration-300 block py-2">Members</a></li><li><a href="/blog.html" class="text-yellow-500 transition duration-300 block py-2">Blog</a></li><li><a href="/gallery.html" class="hover:text-yellow-500 transition duration-300">Gallery</a></li><li><a href="/contact.html" class="hover:text-yellow-500 transition duration-300 block py-2">Join Us</a></li></ul></nav>
    </header>

    <!-- Post Hero / Title Section -->
    <section class="bg-gray-950 pt-24 pb-16 md:pt-32 md:pb-24 border-b border-gray-800">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p id="post-category" class="text-xs text-yellow-500 uppercase tracking-widest mb-4">Loading...</p>
            <h1 id="post-title" class="text-4xl sm:text-6xl font-bold leading-tight text-white oswald mb-6">Loading Post...</h1>
            <div class="flex flex-wrap justify-center items-center space-x-4 text-sm text-gray-500">
                <div class="flex items-center"><i data-lucide="user" class="w-4 h-4 mr-2 text-gray-500"></i><span id="post-author">By...</span></div>
                <span class="text-yellow-500">â€¢</span>
                <div class="flex items-center"><i data-lucide="calendar" class="w-4 h-4 mr-2 text-gray-500"></i><span id="post-date">...</span></div>
            </div>
        </div>
    </section>

    <!-- Featured Media (Image or Video) -->
    <section class="bg-gray-950 pb-16">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div id="post-media-container">
                 <div class="w-full h-auto object-cover rounded-xl shadow-2xl border-2 border-gray-800 bg-gray-900 aspect-video flex items-center justify-center"><p class="text-gray-500">Loading header media...</p></div>
            </div>
        </div>
    </section>

    <!-- Post Content Section -->
    <section class="bg-dark-bg py-16 md:py-20">
        <div id="post-content-container" class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 post-content">
            <p>Loading content...</p>
        </div>
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mt-16 pt-8 border-t border-gray-800 text-center">
            <a href="/blog.html" class="inline-flex items-center px-8 py-3 bg-yellow-500 text-black font-semibold uppercase tracking-wider text-sm rounded-full transition duration-300 hover:bg-yellow-600 shadow-lg hover:shadow-yellow-500/50">
                <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
                Back to The Hive Feed
            </a>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 py-10 border-t border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-sm text-gray-500">
            <p>&copy; 2025 SIMS Media Hive. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- UPDATED SCRIPT with Media Type Check and Marked.js -->
    <script type="module">
        // --- CONFIGURATION ---
        const SUPABASE_URL = 'https://gswdqdsviqrzsoahxapc.supabase.co/'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdzd2RxZHN2aXFyenNvYWh4YXBjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4ODM5NzcsImV4cCI6MjA3NjQ1OTk3N30.JFF6NFIdqZAE9ioHeMdfIVpN84UtN_Z0K2pZYodlpZY';

        // --- INITIALIZATION ---
        const { createClient } = supabase;
        const _supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        // --- Get dynamic elements ---
        const postTitle = document.getElementById('post-title');
        const postCategory = document.getElementById('post-category');
        const postAuthor = document.getElementById('post-author');
        const postDate = document.getElementById('post-date');
        const postMediaContainer = document.getElementById('post-media-container'); // Correct ID
        const postContentContainer = document.getElementById('post-content-container');

        // Function to check if a URL likely points to a video
        function isVideoUrl(url) {
            if (!url) return false;
            const videoExtensions = ['.mp4', '.webm', '.ogg', '.mov', '.avi', '.mkv'];
            const lowerUrl = url.toLowerCase();
            return videoExtensions.some(ext => lowerUrl.endsWith(ext));
        }

        async function loadSinglePost() {
            try {
                // 1. Get ID from URL
                const urlParams = new URLSearchParams(window.location.search);
                const postId = urlParams.get('id');
                if (!postId) throw new Error("No post ID provided.");

                // 2. Fetch the post
                const { data: post, error } = await _supabase.from('blogPosts').select('*').eq('id', postId).single();
                if (error) throw error;
                if (!post) throw new Error("Post not found.");

                // 3. Fill page data
                document.title = post.title + " | SIMS Media Hive";
                postTitle.textContent = post.title;
                postCategory.textContent = "A Post By " + post.author;
                postAuthor.textContent = "By " + post.author;
                postDate.textContent = new Date(post.created_at).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });

                // 4. Create and add the header media (Image OR Video)
                const mediaUrl = post.imageUrl;
                let mediaElementHTML = '';

                if (isVideoUrl(mediaUrl)) {
                    // Create <video> tag
                    mediaElementHTML = `
                        <video
                            src="${mediaUrl}"
                            alt="Header video for ${post.title}"
                            class="w-full h-auto max-h-[600px] object-cover rounded-xl shadow-2xl border-2 border-gray-800"
                            controls loop muted autoplay playsinline preload="metadata"
                        >
                            Your browser doesn't support HTML video. Here is a <a href="${mediaUrl}" target="_blank" class="text-yellow-400 underline">link to the video</a> instead.
                        </video>
                    `;
                } else if (mediaUrl) {
                     // Create <img> tag
                     mediaElementHTML = `
                        <img src="${mediaUrl}"
                             alt="Header image for ${post.title}"
                             class="w-full h-auto max-h-[600px] object-cover rounded-xl shadow-2xl border-2 border-gray-800">
                    `;
                } else {
                    mediaElementHTML = '<p class="text-gray-500 text-center">No header media for this post.</p>';
                }
                postMediaContainer.innerHTML = mediaElementHTML;


                // 5. Render Markdown content to HTML using Marked.js
                 marked.setOptions({ breaks: true, gfm: true });
                 // Ensure Marked.js processes the content safely if needed in future
                 // Consider using DOMPurify: DOMPurify.sanitize(marked.parse(post.content || ''))
                postContentContainer.innerHTML = marked.parse(post.content || ''); // Render the content

            } catch (error) {
                console.error("Error loading post:", error);
                postTitle.textContent = "Error Loading Post";
                postCategory.textContent = ""; postAuthor.textContent = ""; postDate.textContent = "";
                postMediaContainer.innerHTML = "";
                postContentContainer.innerHTML = `<p class="text-center text-red-500 text-lg">Could not load post: ${error.message}</p>`;
            } finally {
                lucide.createIcons();
            }
        }

        // --- Mobile Menu Script (Unchanged) ---
        lucide.createIcons();
        const menuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        if (menuButton) { const menuIcon = menuButton.querySelector('i'); if (mobileMenu && menuIcon) { menuButton.addEventListener('click', () => { mobileMenu.classList.toggle('hidden'); document.body.classList.toggle('overflow-hidden'); const isOpen = !mobileMenu.classList.contains('hidden'); menuIcon.setAttribute('data-lucide', isOpen ? 'x' : 'menu'); lucide.createIcons(); }); document.querySelectorAll('#mobile-menu a').forEach(link => { link.addEventListener('click', () => { mobileMenu.classList.add('hidden'); document.body.classList.remove('overflow-hidden'); menuIcon.setAttribute('data-lucide', 'menu'); lucide.createIcons(); }); }); } }

        // --- Run Supabase logic ---
        document.addEventListener('DOMContentLoaded', loadSinglePost);
    </script>
</body>
</html>

