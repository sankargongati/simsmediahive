<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIMS Media Hive | Blog & Insights</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* Your existing styles */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Oswald:wght@200..700&display=swap');
        :root { --primary-color: #eab308; --dark-bg: #0d0d0d; --mid-bg: #1a1a1a; --text-light: #f3f4f6; --text-muted: #9ca3af; }
        body { font-family: 'Inter', sans-serif; background-color: var(--dark-bg); color: var(--text-light); overflow-x: hidden; padding-top: 6rem; }
        .oswald { font-family: 'Oswald', sans-serif; }
        
        /* Corrected CSS path (removed leading slash) */
        #blog-hero { background-image: url('src/pretty.jpg'); background-size: cover; background-position: center; }
        
        .post-card { background-color: #1a1a1a; }
        /* Style for the temporary video element used for thumbnail generation */
        .thumbnail-generator-video { position: absolute; top: -9999px; left: -9999px; width: 320px; height: auto; }
    </style>
</head>
<body class="antialiased flex flex-col min-h-screen">

    <header class="bg-transparent absolute top-0 left-0 w-full z-20 pt-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-start">
            <div class="text-xl font-extrabold tracking-widest text-white oswald">
                <a href="index.html">SIMS Media Hive</a>
            </div>

            <div class="hidden md:block text-right text-xs text-gray-400">
                <p>gds.simshive@gmail.com</p>
                <p>+91 7981 951 879</p>
            </div>
            
            <button id="mobile-menu-button" class="md:hidden p-2 text-yellow-500 hover:text-white transition duration-300 z-30">
                <i data-lucide="menu" class="w-7 h-7"></i>
            </button>
        </div>

        <nav class="hidden md:flex justify-center mt-4">
            <ul class="flex space-x-8 text-sm font-medium uppercase tracking-widest text-gray-300">
                <li><a href="/index.html" class="hover:text-yellow-500 transition duration-300">Home</a></li>
                <li><a href="/index.html#focus" class="hover:text-yellow-500 transition duration-300">Focus</a></li>
                <li><a href="/index.html#work" class="hover:text-yellow-500 transition duration-300">Projects</a></li>
                <li><a href="/members.html" class="hover:text-yellow-500 transition duration-300">Members</a></li>
                <li><a href="/blog.html" class="hover:text-yellow-500 transition duration-300">Blog</a></li>
                <li><a href="/gallery.html" class="hover:text-yellow-500 transition duration-300">Gallery</a></li>
                <li><a href="/contact.html" class="hover:text-yellow-500 transition duration-300">Join Us</a></li>
            
            </ul>
        </nav>

        <nav id="mobile-menu" class="hidden md:hidden fixed top-0 left-0 w-full h-full bg-gray-950/95 backdrop-blur-sm pt-24 pb-8 overflow-y-auto z-10">
            <ul class="flex flex-col items-center space-y-8 text-xl font-semibold uppercase tracking-widest text-gray-300">
                <li><a href="/index.html" class="hover:text-yellow-500 transition duration-300 block py-2">Home</a></li>
                <li><a href="/index.html#focus" class="hover:text-yellow-500 transition duration-300 block py-2">Focus</a></li>
                <li><a href="/index.html#work" class="hover:text-yellow-500 transition duration-300 block py-2">Projects</a></li>
                <li><a href="/members.html" class="hover:text-yellow-500 transition duration-300 block py-2">Members</a></li>
                <li><a href="/blog.html" class="hover:text-yellow-500 transition duration-300 block py-2">Blog</a></li>
                <li><a href="/gallery.html" class="hover:text-yellow-500 transition duration-300 block py-2">Gallery</a></li>
                <li><a href="/contact.html" class="hover:text-yellow-500 transition duration-300 block py-2">Join Us</a></li>
            </ul>
        </nav>
    </header>

    <main class="flex-grow">
        <section id="blog-hero" class="relative py-24 md:py-40 flex items-center">
            <div class="absolute inset-0 bg-black bg-opacity-70"></div>
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-0 text-center"><p class="text-sm text-yellow-500 uppercase tracking-widest mb-4">Insights, Tutorials, and News</p><h1 class="text-5xl sm:text-7xl font-bold leading-tight text-white oswald mb-4"> The Hive Feed </h1><p class="text-xl text-gray-300 max-w-3xl mx-auto"> Stay updated with our latest productions, technical tips, and media industry commentary. </p></div>
        </section>

        <section class="bg-gray-950 py-20 md:py-32">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-3xl font-bold text-white oswald mb-12">Latest Articles</h2>
                <div id="blog-posts-container" class="grid grid-cols-1 md:grid-cols-3 gap-10">
                    <p class="text-gray-400 col-span-full text-center">Loading articles...</p>
                </div>
            </div>
        </section>
    </main>

   <footer class="bg-gray-900 border-t border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-12">
                
                <div>
                    <h3 class="text-xl font-extrabold tracking-widest text-white oswald mb-4">
                        <a href="index.html">SIMS Media Hive</a>
                    </h3>
                    <p class="text-gray-400 text-sm mb-4 max-w-xs">
                        Your creative partner in digital media production, storytelling, and impactful content.
                    </p>
                    <div class="space-y-2 text-sm text-gray-400">
                        <p class="flex items-center">
                            <i data-lucide="mail" class="inline w-4 h-4 mr-2 text-yellow-500 shrink-0"></i>
                            <span>gds.simshive@gmail.com</span>
                        </p>
                        <p class="flex items-center">
                            <i data-lucide="phone" class="inline w-4 h-4 mr-2 text-yellow-500 shrink-0"></i>
                            <span>+91 7981 951 879</span>
                        </p>
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-semibold text-white oswald tracking-wider mb-4">Quick Links</h4>
                    <ul class="space-y-3 text-sm">
                        <li><a href="/index.html" class="text-gray-400 hover:text-yellow-500 transition duration-300">Home</a></li>
                        <li><a href="/index.html#work" class="text-gray-400 hover:text-yellow-500 transition duration-300">Projects</a></li>
                        <li><a href="/members.html" class="text-gray-400 hover:text-yellow-500 transition duration-300">Members</a></li>
                        
                        <li><a href="/login.html" class="text-gray-400 hover:text-yellow-500 transition duration-300">Member Login</a></li>
                        
                        <li><a href="/blog.html" class="text-gray-400 hover:text-yellow-500 transition duration-300">Blog</a></li>
                        <li><a href="/gallery.html" class="text-gray-400 hover:text-yellow-500 transition duration-300">Gallery</a></li>
                        <li><a href="/contact.html" class="text-gray-400 hover:text-yellow-500 transition duration-300">Join Us</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="text-lg font-semibold text-white oswald tracking-wider mb-4">Follow Us</h4>
                    <p class="text-sm text-gray-400 mb-4">Stay connected on our social channels.</p>
                    
                    <div class="flex space-x-4 justify-center md:justify-start">
                        <a href="#" aria-label="Instagram" class="text-gray-400 hover:text-yellow-500 transition duration-300">
                            <i data-lucide="instagram" class="w-6 h-6"></i>
                        </a>
                        <a href="#" aria-label="YouTube" class="text-gray-400 hover:text-yellow-500 transition duration-300">
                            <i data-lucide="youtube" class="w-6 h-6"></i>
                        </a>
                        <a href="#" aria-label="Facebook" class="text-gray-400 hover:text-yellow-500 transition duration-300">
                            <i data-lucide="facebook" class="w-6 h-6"></i>
                        </a>
                        <a href="#" aria-label="LinkedIn" class="text-gray-400 hover:text-yellow-500 transition duration-3D00">
                            <i data-lucide="linkedin" class="w-6 h-6"></i>
                        </a>
                    </div>
                </div>

            </div>

            <div class="mt-16 pt-8 border-t border-gray-800 text-center text-sm text-gray-500">
                <p>&copy; 2025 SIMS Media Hive. All Rights Reserved. Designed by <a href="https://dcagency.in" target="_blank" class="hover:text-yellow-500 transition">Darion Creative Agency.</a></p>
            </div>

        </div>
    </footer>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // --- Mobile Menu Toggle Logic ---
        const menuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const menuIcon = menuButton.querySelector('i');

        menuButton.addEventListener('click', () => {
            // Toggle the 'hidden' class on the mobile menu
            mobileMenu.classList.toggle('hidden');
            
            // Toggle the visibility of the main body content (to prevent scrolling behind the menu)
            document.body.classList.toggle('overflow-hidden');

            // Toggle the icon (Menu <-> X)
            const isMenuOpen = !mobileMenu.classList.contains('hidden');
            if (isMenuOpen) {
                // Menu is open, show 'x' icon
                menuIcon.setAttribute('data-lucide', 'x');
            } else {
                // Menu is closed, show 'menu' icon
                menuIcon.setAttribute('data-lucide', 'menu');
            }
            lucide.createIcons(); // Re-render the icon
        });

        // Close the mobile menu when a link is clicked
        document.querySelectorAll('#mobile-menu a').forEach(link => {
            link.addEventListener('click', () => {
                // Close the menu
                mobileMenu.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
                
                // Reset the icon
                menuIcon.setAttribute('data-lucide', 'menu');
                lucide.createIcons();
            });
        });
    </script>

    <script>
        // --- CONFIGURATION ---
        const SUPABASE_URL = 'https://gswdqdsviqrzsoahxapc.supabase.co/'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdzd2RxZHN2aXFyenNvYWh4YXBjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4ODM5NzcsImV4cCI6MjA3NjQ1OTk3N30.JFF6NFIdqZAE9ioHeMdfIVpN84UtN_Z0K2pZYodlpZY';

        // --- INITIALIZATION ---
        const { createClient } = supabase;
        const _supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        const postsContainer = document.getElementById('blog-posts-container');
        const defaultPlaceholder = 'https://placehold.co/600x400/1c1917/f59e0b?text=IMAGE';
        
        // --- Helper Functions ---
        function isVideoUrl(url) {
            if (!url) return false;
            const videoExtensions = ['.mp4', '.webm', '.ogg', '.mov', '.avi', '.mkv'];
            const lowerUrl = url.toLowerCase();
            return videoExtensions.some(ext => lowerUrl.endsWith(ext));
        }

        async function generateVideoThumbnail(videoUrl) {
            return new Promise((resolve) => {
                const video = document.createElement('video');
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                let resolved = false; 
                video.classList.add('thumbnail-generator-video');
                video.muted = true;
                video.playsInline = true;
                video.preload = 'metadata';
                video.crossOrigin = 'anonymous'; 

                const onError = (e) => {
                    if (resolved) return;
                    console.warn(`Thumbnail generation failed for ${videoUrl}:`, e);
                    cleanup();
                    resolve(null); 
                };

                const cleanup = () => {
                    video.removeEventListener('loadeddata', onLoadedData);
                    video.removeEventListener('seeked', onSeeked);
                    video.removeEventListener('error', onError);
                    video.removeEventListener('stalled', onError);
                     if (video.parentNode) {
                         video.parentNode.removeChild(video);
                     }
                };

                 const timeoutId = setTimeout(() => {
                     if (resolved) return;
                     console.warn(`Thumbnail generation timed out for ${videoUrl}`);
                     cleanup();
                     resolve(null);
                 }, 7000); 

                const onLoadedData = () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    video.currentTime = Math.min(1, video.duration / 2);
                };

                const onSeeked = () => {
                     if (resolved) return;
                    try {
                        context.drawImage(video, 0, 0, canvas.width, canvas.height);
                        const dataUrl = canvas.toDataURL('image/jpeg', 0.7);
                        resolved = true;
                        clearTimeout(timeoutId);
                        cleanup();
                        resolve(dataUrl);
                    } catch (drawError) {
                         onError(drawError);
                    }
                };

                video.addEventListener('loadeddata', onLoadedData);
                video.addEventListener('seeked', onSeeked);
                video.addEventListener('error', onError);
                video.addEventListener('stalled', onError);

                video.src = videoUrl;
                video.load(); 
            });
        }

        // --- SUPABASE BLOG POST LOGIC ---
        async function loadBlogPosts() {
            if (!postsContainer) {
                console.error("Blog posts container not found!");
                return;
            }
            postsContainer.innerHTML = '<p class="text-gray-400 col-span-full text-center">Loading articles...</p>';
            try {
                const { data, error } = await _supabase
                    .from('blogPosts')
                    .select('id, title, author, imageUrl, created_at')
                    .order('created_at', { ascending: false });

                if (error) throw error;
                postsContainer.innerHTML = ''; 

                if (data.length === 0) {
                    postsContainer.innerHTML = '<p class="text-gray-400 col-span-full text-center">No articles have been published yet.</p>';
                    return;
                }
                
                const postPromises = data.map(async (post) => {
                    const postDate = new Date(post.created_at).toLocaleDateString('en-US', {
                        month: 'short', day: 'numeric', year: 'numeric'
                    });

                    let imageSource = defaultPlaceholder; 
                    if (post.imageUrl) {
                        if (isVideoUrl(post.imageUrl)) {
                            const thumbnailUrl = await generateVideoThumbnail(post.imageUrl);
                            if (thumbnailUrl) {
                                imageSource = thumbnailUrl; 
                            } else {
                                imageSource = defaultPlaceholder; 
                                console.warn(`Using placeholder for video: ${post.title}`);
                            }
                        } else {
                            imageSource = post.imageUrl;
                        }
                    }

                    return `
                        <a href="post.html?id=${post.id}" class="block post-card rounded-lg overflow-hidden transition duration-300 hover:shadow-yellow-500/20 shadow-xl">
                            <img src="${imageSource}"
                                 onerror="this.onerror=null;this.src='${defaultPlaceholder}';"
                                 alt="Preview for ${post.title}" class="w-full h-48 object-cover bg-gray-700">
                            <div class="p-6">
                                <h3 class="text-xl font-bold text-white oswald mb-2 hover:text-yellow-400 transition duration-200">
                                    ${post.title}
                                </h3>
                                <p class="text-sm text-gray-400">
                                    By ${post.author}
                                </p>
                                <p class="text-xs text-gray-500 mt-4">${postDate}</p>
                            </div>
                        </a>
                    `;
                });

                const postHTMLArray = await Promise.all(postPromises);
                postsContainer.innerHTML = postHTMLArray.join('');

            } catch(error) {
                console.error("Error loading blog posts:", error);
                postsContainer.innerHTML = `<p class="text-center text-red-500 text-lg col-span-full">Could not load articles. Error: ${error.message}</p>`;
            } finally {
                 lucide.createIcons();
            }
        }

        // --- Run Blog Post Logic ---
        // This runs separately from the menu script.
        loadBlogPosts();
    </script>
</body>
</html>
